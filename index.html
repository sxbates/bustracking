<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Real Time Bus Tracker</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css" rel="stylesheet" />

<style>
  body { margin: 0; padding: 0; }
  #map { position: absolute; top: 0; bottom: 0; width: 100%; }
  .map-overlay{
    position: absolute;
    left: 0;
    padding: 10px;
  }
</style>
</head>
<body>
  <div id="map"></div>
  <div class="map-overlay">
  </div>
  
  <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoic3hiYXRlcyIsImEiOiJja3NwZmh3NzMwMmVvMzBxa3QwNGg5OTZvIn0.KChL6-84vHu8Q2mCijfw3g'
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [-71.104081,42.365554],
            zoom: 15
        });
        var marker = new mapboxgl.Marker()
            // .setLngLat([142.7489,-19.6270])
            // .addTo(map)


    
    async function run(){
        // get bus data    
      const locations = await getBusLocations();

      //array of locations
      console.log(locations);

      //currently sets Lng and Lat of marker to first intem in locations array 
      marker.setLngLat([locations[0].attributes.longitude, locations[0].attributes.latitude]);

      //add marker to map
      marker.addTo(map); 
    }
    
    // Request bus data from MBTA
    async function getBusLocations(){
      const url = 'https://api-v3.mbta.com/vehicles?filter[route]=1&include=trip';
      const response = await fetch(url);
      const json     = await response.json();
      return json.data;
    }
    
    setInterval(move, 3000);
    
    function move(){
      run();
      // marker.setLngLat(locationdata);  
    };
    </script>
</body>
</html>